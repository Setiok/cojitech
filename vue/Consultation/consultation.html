<!DOCTYPE html>
<html>
<head>
	
	<title>Consultation</title>
</head>
<body>
	<?php testco(); //test de la connexion a la bdd 
	?>
	<h1>Consultation</h1>
	<!--affichage du tableau d'ajout-->
	<div id="consultation_ajout">
		<table id="liste">
			<th>
				<tr class="th">
					<th>
						Désignation
					</th>
					<th>
						Etat
					</th>
					<th>
						Quantité
					</th>
				</tr>
			</th>
			<!-- Fin affichage th tableau -->
			<form method="post" action='controleur/ajout.php'>
				<tr>
					<td> 
						<input id="design" list="Désignation" type="text" name="designation" autocomplete="off">
						<datalist id="Désignation" >
							<?php
							$sth=ReturnDesignation(); //recuperation des designations
							foreach ($sth as $value) {
								echo $value;
								?>
								<option value="<?php echo $value ?>" > <?php echo $value ?>
								</option>
								<?php
							};
							?>
						</datalist>
					</td>
					<td>
						<select id="etat" name="etat">
							<option value="neuf"> neuf </option>
							<option value="reconditioné"> reconditionné </option>
						</select>

					</td>
					<td>
						<input list="qte" type="number" name="quantité" id="qte" autocomplete="off" required pattern="[0-9]" value="0" onchange="afficherCheckbox()">
					</td>
				</tr>
			</table>
			<button type="submit" name="btn1" value="on">Modifier la quantité</button> <!-- modification de la quantité -->
			<button type="submit" name="btn2" value="on">Ajouter ou modifier se materiel</button> <!-- acces page ajout/modification avec la designation rentré -->
		</form>


		<script type="text/javascript" language="JavaScript">


/*		function afficherCheckbox(){

			var ou=document.getElementById("ou").value;
			var qte=document.getElementById("qte").value;

			if (ou=="stock") {
				document.getElementById("thCheckImputer").style.display="none";
				document.getElementById("tdCheckImputer").style.display="none";
				document.getElementById("thCheckAjout").style.display="none";
				document.getElementById("tdCheckAjout").style.display="none";
				document.getElementById("checkImputer").checked=false;
				document.getElementById("checkAjout").checked=false;
			}
			else{
				if (qte<0) {
					document.getElementById("thCheckAjout").style.display="";
					document.getElementById("tdCheckAjout").style.display="";
					document.getElementById("thCheckImputer").style.display="none";
					document.getElementById("tdCheckImputer").style.display="none";
					document.getElementById("checkImputer").checked=false;
				}
				else{
					document.getElementById("thCheckImputer").style.display="";
					document.getElementById("tdCheckImputer").style.display="";
					document.getElementById("thCheckAjout").style.display="none";
					document.getElementById("tdCheckAjout").style.display="none";
					document.getElementById("checkAjout").checked=false;
				}

			}
		}
		*/
	</script>
</div>
<!-- fin affichage du menu ajout -->



<!--contenu unique de la page consultation -->
<div id="contenu"  style="overflow: auto;"> 



	<!--Motteur de recherche -->
	<div class="search">
		<form method="post" action="controleur/search.php">
			<input type="text" name="txtRecherche">
			<select onchange="" name="ouChercher">
				<option>Désignation</option>
				<option>Référence</option>
				<option>Constructeur</option>
				<option>Famille</option>
				
			</select>
			<button type="submit" name="btnRecherche">
				Recherche
			</button>

		</form>
	</div>
	<!--Fin Motteur de recherche -->




	<!-- affichage de la liste de tous les materiels par defaut ou d'une catégorie en fonction du sous-menu -->
	<div>
		<ul id="menu2">
			<li>
				<a href="index.php?MenuP=Consultation">Tous</a>
			</li>
			<li>
				<a href="index.php?MenuC=Stock">Stock</a>
			</li>
		</ul>
	</div>
	<?php
			if (isset($_SESSION["searchTemp"])) {
				$sth=afficherMaterielRechercher();
				//var_dump($_SESSION["searchTemp"]);
				//var_dump($_SESSION["searchTemp2"]);
				//var_dump($sth);
				unset($_SESSION["searchTemp"]);
				unset($_SESSION["searchTemp2"]);
			}
			elseif (isset($_SESSION['page'])) { // recuperation du tableau de données
				$sth=afficherMaterielTri();
			}
			else{
				$sth=afficherMateriel();
			}
			
			$i=false;
			$cpt=0;
			?>
			<div id="tableau">
				<table id=table>
					<?php
			foreach ($sth as $table){ //boucle pour l'afichage des données
			if ($i==false) { 
				?>
				<thead>
					<tr class="th">
						<th>
							Référence
						</th>
						<th>
							Désignation
						</th>
						<th>
							Constructeur
						</th>
						<th>
							Famille
						</th>
						<th>
							Etat
						</th>
						<th>
							Qte Stock
						</th>
						<th>
							Qte Minimale
						</th>
						<th>
							Fournisseur
						</th>
						<th>
							Emplacement
						</th>
					</tr>
				</thead>
				<?php
				$i=true;
			};
			?><tr onclick="selectLigne(<?php echo $cpt ?>)"><?php

			foreach($table as $key => $value){
				if ($key=="designation") {
					?>
					<td style="display: none">
						<input type="radio" name="point" value="<?php echo $value ?>" id="<?php echo $cpt; ?>"  >
					</td>
					<?php	
				};
				?>
				<td id="case">
					<label for="<?php echo $cpt;?>" >
						<?php
						echo $value;
						//echo "//",$cpt;
						?>
					</label>
				</td>
				<?php
			};
			$cpt++;
			?></tr><?php 
		}; 
		?>


	</table>
</div>
<?php 
unset($sth);
?>
</div>

<script type="text/javascript">
	function selectLigne($compteur){
		document.getElementById($compteur).checked=true;
		document.getElementById("design").value=document.getElementById($compteur).value;
	};
</script>




</body>
</html>